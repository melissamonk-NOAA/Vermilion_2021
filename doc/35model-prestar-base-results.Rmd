# Assessment Results

The base model parameter estimates along with approximate asymptotic standard errors are shown in Table \ref{tab:params} and the likelihood components are shown in Table \@ref(tab:parms). Estimates of derived reference points and approximate 95 percent asymptotic confidence intervals are shown in Table \@ref(tab:referenceES). Estimates of stock size and status over time are shown in Table \@ref(tab:timeseries). 


## Parameter Estimates

```{r parameters, include = FALSE, eval = TRUE, cache = TRUE}
# get parameter names from base model
estimated_pars <- model$parameters %>%
  dplyr::filter(!is.na(Active_Cnt)) %>%
  rownames()
```

The base model has a total of `r length(estimated_pars)` estimated parameters
(Figure \@ref(tab:params)) that can be grouped into the following
categories and are described in more detail in the following sections:


```{asis, echo = model.area=='NCA'}
Biological parameters  
- 1 natural mortality parameter (female and male assumed the same)  
- 8 growth parameters, where the Age at Lmin and CV for old ma
- 3 Schnute growth parameters (length at age 0, length at age 30, and $k$)   
- 3 parameters controlling variability in growth, the CV in length at age 0  
  and the CV in length at age 30 with a linear ramp in length-at-age  (CV for young males was not estimated)
```                                                                   

```{asis, echo = model.area=='SCA'}
Biological parameters  
- 1 natural mortality parameter (female and male assumed the same)  
- 9 growth parameters, where the Age at Lmin and CV for old ma
- 3 Schnute growth parameters (length at age 0, length at age 30 for both sexes, and $k$)   
- 4 parameters controlling variability in growth, the CV in length at age 0  
  and the CV in length at age 30 with a linear ramp in length-at-age  (CV for young males was not estimated)
```

Stock-recruit parameters  
- `r 2 + nrow(model$recruit)` recruitment parameters  
- $log(R_0)$ controlling equilibrium recruitment  
- `r nrow(model$recruit)` recruitment deviations parameters covering the range  
  `r min(model$recruit$Yr)`-`r max(model$recruit$Yr)`, with 
  `r min(model$recruit$Yr[model$recruit$era=="Main"])`-`r max(model$recruit$Yr[model$recruit$era=="Main"])`
  representing the "main" period modeled as a zero-centered deviation vector  
  
Index parameters  
- `r sum(sum(grepl("Q_extra", estimated_pars)))` extra standard deviation parameters
for indices  

Selectivity parameters  
- `r sum(grepl("Size_DblN", estimated_pars))` selectivity parameters, of which
`r sum(grepl("Size_DblN.*BLK", estimated_pars))` represented changes over time  

## Fixed parameters
- $h$ controlling the steepness of the stock-recruit relationship
- $M$ for males
- Selectivity parameters that were estimated at the bounds and fixed in the pre-STAR model

## Natural Mortality

```{asis, echo = model.area=='NCA'}
Female natural mortality was estimated at 0.09 and male natural mortality was fixed at the female-estimated value. 

```


```{asis, echo = model.area=='SCA'}
Female natural mortality was estimated at 1.12 and male natural mortality was fixed at the female-estimated value, using an offset of 0.

```

## Growth (Length-at-Age)
```{r, include=FALSE, echo = FALSE}
# calculate Linf and t0 from Schnute vB parameterization
unSchnute.fn <- function(Amin, Amax, Lmin, Lmax, k)
{
   Linf <- Lmin + (Lmax-Lmin)/(1-exp(-k*(Amax-Amin)))
   t0   <- Amin + Amax - (1/k)*log((exp(k*Amax)*Lmax - exp(k*Amin)*Lmin)/(Lmax-Lmin))
   out  <- c(Linf, t0)
   names(out) <- c("Linf","t0")
   return(out)
}
# vermilion example
# females 
female_growth <- unSchnute.fn(0, 30, model$MGparmAdj$L_at_Amin_Fem_GP_1[1], model$MGparmAdj$L_at_Amax_Fem_GP_1[1], model$MGparmAdj$VonBert_K_Fem_GP_1[1])

if(model.area=="SCA"){
# for males,  apply exponential offsets to the female values
male_growth <- unSchnute.fn(0, 30,  
   model$MGparmAdj$L_at_Amin_Fem_GP_1[1]*exp(model$MGparmAdj$L_at_Amin_Mal_GP_1[1]),     model$MGparmAdj$L_at_Amax_Fem_GP_1[1]*exp(model$MGparmAdj$L_at_Amax_Max_GP_1[1]), model$MGparmAdj$VonBert_K_Fem_GP_1[1]*exp(model$MGparmAdj$VonBert_K_Mal_GP_1[1]))
} else {

male_growth <- unSchnute.fn(0, 30, 
                            model$MGparmAdj$L_at_Amin_Mal_GP_1[1],
                            model$MGparmAdj$L_at_Amax_Mal_GP_1[1],
                            model$MGparmAdj$VonBert_K_Mal_GP_1[1])

}
```


```{asis, echo = model.area=='NCA'}
Internal estimates of growth were estimated directly for males, and not as an offset. An offset for male growth was explored, but the CV of length at $L_{age=30}$ was estimated around 2-3%.  When the male CV was fixed to female CV, the assessment model shrunk the CV of females at $L_{age=30}$, which the STAT did not find reasonable.  Therefore, the male CV at $L_{age=30}$ was fixed at the CV estimated for females of 0.07 (Figure \@ref(fig:fittedgrowth)).

The direct estimation of male  $L_{age=0}=6.02$ cm was reasonable compared to female  $L_{age=0}=7.8$.  While $k$ was estimated  larger for males (0.19) than females (0.15), female size at t $L_{age=30}$  of 55 cm was larger than males at 79 cm.  These results are consistent with other studies that have looked at sex-specific growth in vermilion rockfish.
```

```{asis, echo = model.area=='SCA'}
The male growth parameters were estimated as offsets to female growth, with the male  $L_{age=0}$ and associated CV fixed to the same estimates as females (7.7 cm and a CV of 0.9). Female $k$ was estimated at 0.16, slightly higher than the estimates for males of $k$ of 0.13.  Females reached a larger size at $L_{age=30}$ of 55 cm than males, which reached an estimated $L_{age=30}$ of 52 cm (Figure \@ref(fig:fittedgrowth)).  The CVâ€™s of the $L_{age=30}$ for males and females were 0.07 and 0.6, respectively


```

Estimates of the traditional vonBertallanffy parameters transformed from the Schnute parameterization used by SS are below.  In both parameterizations, the $k$ parameter is the same.
\begin{centering}

Females $L_{\infty}$ = `r round(female_growth[1], 1)` cm; $k$ = `r round(model$MGparmAdj$VonBert_K_Fem_GP_1[1], 3)`; $t_0$ = `r round(female_growth[2], 2)`

Males $L_{\infty}$ = `r round(male_growth[1])` cm; $k$ = `r round(model$MGparmAdj$VonBert_K_Mal_GP_1[1], 3)`; $t_0$ = `r round(male_growth[2], 2)`

\end{centering}

\vspace{0.5cm}

## Selectivity

The estimated length sensitivities by fleets are shown in Figure \@ref(fig:selex-length-all) 
and by age in Figure \@ref(fig:selex-age-all)  


```{asis, echo = model.area=='NCA'}
Time varying selectivititues for the recreational PC fishery
Figure \@ref(fig:sel03_len_timevary_surf_flt4sex1)    #
Figure \@ref(fig:sel03_len_timevary_surf_flt6sex1)   #
Figure \@ref(fig:endyr-selex-COM-HKL)  
Figure \@ref(fig:endyr-selex-COM-TWL)  
Figure \@ref(fig:endyr-selex-COM-NET)  
Figure \@ref(fig:endyr-selex-REC-PC)  
Figure \@ref(fig:endyr-selex-REC-PC-DIS)  
Figure \@ref(fig:endyr-selex-REC-PR)  
Figure \@ref(fig:endyr-selex-REC-PR-DIS)  
Figure \@ref(fig:endyr-selex-NWFSC-TWL)  

```


```{asis, echo = model.area=='SCA'}
Figure \@ref(fig:selex-length-all)  
Figure \@ref(fig:selex-age-all)  
Figure \@ref(fig:sel03_len_timevary_surf_flt4sex1)    #
Figure \@ref(fig:sel03_len_timevary_surf_flt6sex1)   #
Figure \@ref(fig:endyr-selex-COM-HKL)  
Figure \@ref(fig:endyr-selex-COM-TWL)  
Figure \@ref(fig:endyr-selex-COM-NET)  
Figure \@ref(fig:endyr-selex-REC-PC)  
Figure \@ref(fig:endyr-selex-REC-PC-DIS)  
Figure \@ref(fig:endyr-selex-REC-PR)  
Figure \@ref(fig:endyr-selex-REC-PR-DIS)  
Figure \@ref(fig:endyr-selex-NWFSC-TWL)  

```


## Recruitment Deviations


```{asis, echo = model.area=='NCA'}

Figure \@ref(fig:recruits)  
Figure \@ref(fig:rec-devs)  

```


```{asis, echo = model.area=='SCA'}

Figure \@ref(fig:recruits)  
Figure \@ref(fig:rec-devs)  

```




## Fits to the Data
Model fits to the indices of abundance, fishery length composition, survey length 
composition, and conditional age-at-length observations are all discussed below. 
The full r4ss plotting output is available in the supplementary material.


### Data weighting

Francis weighting was selected and provided better fits to the indices 
and was re-tuned for five iterations to determine if the method serially downweighted any 
one data source.


*Indices*


```{asis, echo = model.area=='NCA'}

Figure \@ref(fig:cpueall)  
Figure \@ref(fig:log-cpue-REC-PC)    
Figure \@ref(fig:cpue-resid-REC-PC)
Figure \@ref(fig:log-cpue-REC-PR)  
Figure \@ref(fig:cpue-resid-REC-PR)  
Figure \@ref(fig:log-cpue-DWV-ONBOARD)  
Figure \@ref(fig:cpue-resid-DWV-ONBOARD)  
Figure \@ref(fig:log-cpue-REC-PC-ONBOARD)  
Figure \@ref(fig:cpue-resid-REC-PC-ONBOARD)  
Figure \@ref(fig:log-cpue-CCFRP)  
Figure \@ref(fig:cpue-resid-CCFRP)  


```


```{asis, echo = model.area=='SCA'}

```


*Length Composition*


```{asis, echo = model.area=='NCA'}
Figure \@ref(fig:lenfits-all)  
Figure \@ref(fig:len-pearson-COM-HKL)  and Figure \@ref(fig:mean-len-fit-COM-HKL)  
Figure \@ref(fig:len-pearson-COM-TWL)  and Figure \@ref(fig:mean-len-fit-COM-TWL)  
Figure \@ref(fig:len-pearson-COM-NET)  and Figure \@ref(fig:mean-len-fit-COM-NET)  
Figure \@ref(fig:len-pearson-REC-PC)  and Figure \@ref(fig:mean-len-fit-REC-PC)  
Figure \@ref(fig:len-pearson-REC-PC-DIS)  and Figure \@ref(fig:mean-len-fit-REC-PC-DIS)  
Figure \@ref(fig:len-pearson-DWV-ONBOARD)  and Figure \@ref(fig:mean-len-fit-DWV-ONBOARD)  
Figure \@ref(fig:len-pearson-NWFSC-TWL)  and Figure \@ref(fig:mean-len-fit-NWFSC-TWL)  
Figure \@ref(fig:len-pearson-ABRAMS-RESEARCH)  and Figure \@ref(fig:mean-len-fit-ABRAMS-RESEARCH)  
Figure \@ref(fig:len-pearson-SWFSC-GF-ECOL)  and Figure \@ref(fig:mean-len-fit-SWFSC-GF-ECOL)  
Figure \@ref(fig:len-pearson-CCFRP)    and Figure \@ref(fig:mean-len-fit-CCFRP)  


```


```{asis, echo = model.area=='SCA'}

```

*Conditional Age at Length*


```{asis, echo = model.area=='NCA'}

Figure \@ref(fig:ssb)  
Figure \@ref(fig:depl)  
Figure \@ref(fig:comp_condAALfit_residsflt9mkt0_page1)   #
Figure \@ref(fig:comp_condAALfit_residsflt9mkt0_page3)   #
Figure \@ref(fig:comp_condAALfit_residsflt11mkt0)   #
Figure \@ref(fig:comp_condAALfit_residsflt12mkt0)   #
Figure \@ref(fig:comp_condAALfit_Andre_plotsflt9mkt0_page1)   #
Figure \@ref(fig:comp_condAALfit_Andre_plotsflt9mkt0_page4)   #

```


```{asis, echo = model.area=='SCA'}

```



*Stock recruitment curve*
Figure \@ref(fig:bh-curve)
Figure \@ref(fig:bh-resids)




## Population Trajectory


```{asis, echo = model.area=='NCA'}

```


```{asis, echo = model.area=='SCA'}

```


### Reference Points
Reference points were calculated using the estimated selectivities and catch distribution among fleets in the most recent year of the model, `r endyr`. 
Sustainable total yield (landings plus discards) was 
`r round(model$derived_quants[model$derived_quants$Label == 'Dead_Catch_SPR', 'Value'], 2)` mt when using an $SPR_{50\%}$ 
reference harvest rate. The spawning output equivalent to 40% of the unfished level ($SB_{40\%}$) was `r round(model$derived_quants[model$derived_quants$Label == 'SSB_SPR', 'Value'], 2)` 
million eggs. 

The predicted spawning output from the base model shows frogs (Figure \@ref(fig:ssb)).  The spawning output then frogs.

The `r endyr`. spawning biomass relative to unfished equilibrium spawning biomass is above the target of 40% of unfished levels (Figure \@ref(fig:depl)). 
The relative fishing intensity, $(1-SPR)/(1-SPR_{50\%})$, was above the management target frogs (Figure \@ref(fig:1-spr)). The relative fishing intensity has been frogs (Figure \@ref(fig:phase)).

Table \ref{tab:ref-pts} shows the full suite of estimated reference points for the base model and Figures \@ref(fig:yield2) and \@ref(fig:yield3) show the equilibrium curve based on a steepness value fixed at `r round(model$parameters[model$parameters$Label == "SR_BH_steep","Value"], 2)`.




