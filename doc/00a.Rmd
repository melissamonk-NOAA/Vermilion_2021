---
geometry: margin=1in
month: "`r format(Sys.Date(), '%B')`"
year: "`r format(Sys.Date(), '%Y')`"
params:
    model: "south"
preamble: |
output:
  sa4ss::techreport_pdf:
    default
  bookdown::pdf_document2:
    keep_tex: true
    keep_md: true
header-includes:
  - \usepackage{booktabs}
  - \usepackage{longtable}
  - \usepackage{array}
  - \usepackage{multirow}
  - \usepackage{wrapfig}
  - \usepackage{float}
  - \usepackage{colortbl}
  - \usepackage{pdflscape}
  - \usepackage{tabu}
  - \usepackage{threeparttable}
  - \usepackage[normalem]{ulem}
  - \usepackage{makecell}
  - \usepackage{xcolor}
  - \usepackage{placeins}
  - \usepackage{enumerate}
lang: en
papersize: a4
---

<!-- Common lat/long 
Cape Mendocino, Pt. Conception and OR border -->
\newcommand\CapeM{$40^\circ 10^\prime N$}
\newcommand\PtC{$34^\circ 27^\prime N$}
\newcommand\CAOR{$42^\circ 00^\prime N$}


```{r opts, include = FALSE}
library(kableExtra)
knitr::opts_chunk$set(echo = FALSE, warning = FALSE, message = FALSE)
knitr::knit_hooks$set(plot = function(x,options) {
      base = knitr::opts_knit$get('base.url')
      if (is.null(base)) base = ''
      alt = ifelse (is.null(options$alt),"",options$alt)
      cap = ifelse (is.null(options$caption),"",options$caption)
      if (alt != ""){
        sprintf('![%s](%s%s "%s")', cap, base, x, alt)
      } else {
        sprintf('![%s](%s%s)', cap, base, x)
        }
  })
options(knitr.duplicate.label = "allow") #allow duplicate labels - needed for longtable
options(knitr.kable.NA = '') #print blank cells in tables with NA

 
source("C:/Stock_Assessments/VRML_Assessment_2021/GitHub/Vermilion_2021/code/dir_recent.R")
dir.path <- ifelse(params$model=="north",
             "C:/Stock_Assessments/VRML_Assessment_2021/Model_files/NCA/",
             "C:/Stock_Assessments/VRML_Assessment_2021/Model_files/SCA/")
model.dir <- dir_recent(dir = dir.path, pattern = "Verm")
base_loc <- paste0(model.dir)


if (is.null(params$model) & file.exists("00mod.Rdata")) {
  stopifnot(file.exists("00mod.Rdata"))
  load("00mod.Rdata")
} else {
  load(dir(base_loc, pattern = "00mod.Rdata", full.names = TRUE))
}

model.area <- ifelse(params$model=="north", "NCA", "SCA")
spp = 'vermilion rockfish'
Spp = 'Vermilion rockfish'
fig_loc = paste0(getwd(), "/figures")
table_loc = paste0(getwd(), "/tables")
tex_tables_loc = paste0(getwd(),"/tex_tables/", params$model)
tex_parent_loc = paste0(getwd(),"/tex_tables/")
#move the tex tables to the parent folder depending on which model you're working on 
#best solution I have so far
files <- list.files(path = tex_tables_loc, full.names = TRUE)
files_new <- gsub(dirname(files[1]), tex_parent_loc, files)
for (i in 1:length(files)){
  file.copy(files[i], files_new[i])
}


# model_loc = "C:/Stock_Assessments/VRML_Assessment_2021/Model_files/"



if(params$model=="north"){
model$FleetNames_parsed <- c("commercial hook-and-line fishery",
                           "commercial trawl fishery",
                           "commercial net fishery",
                           "recreational PC retained fishery",
                           "recreational PC discard fishery",
                           "recreational PR retained fishery",
                           "recreational PR discard fishery",
                           "Deb Wilson-Vandenberg onboard survey",
                           "West coast groundfish bottomfish trawl survey",
                           "recreational PC onboard survey",
                           "Abrams thesis research survey",
                           "SWFSC groundfish ecology survey",
                           "California Collaborative Fisheries Research Project survey")
} else {
model$FleetNames_parsed <- c("commercial hook-and-line fishery",
                           "commercial trawl fishery",
                           "commercial net fishery",
                           "recreational PC retained fishery",
                           "recreational PC discard fishery",
                           "recreational PR retained fishery",
                           "recreational PR discard fishery",
                           "NWFSC hook-and-line survey",
                           "West Coast Groundfish Bottomfish Trawl Survey",
                           "recreational PC onboard survey",
                           "CDFW reserach (aka green binder)",
                           "Dummy fleet")
}

model$FleetNames_label <- stringr::str_replace_all(model$FleetNames, "_", "-")

fleet_info = data.frame(cbind(model$fleet_ID, model$FleetNames, model$FleetNames_label, model$FleetNames_parsed))
colnames(fleet_info) = c("fleet_ID", "FleetNames", "FleetNames_label", "FleetNames_parsed")

plot_info = read.csv(file.path(mod_loc, "plots", "plotinfotable_for_doc.csv"))

```
